# Requirements Document

## Introduction

このドキュメントは、AndroidアプリでYouTube ShortsやInstagram Reelsなどのショート動画コンテンツを選択的にブロックする機能の要件を定義します。重要なのは、アプリ全体をブロックするのではなく、ショート動画セクションのみをブロックし、通常のコンテンツ（YouTube動画、Instagramフィード等）は引き続き利用可能にすることです。

## Requirements

### Requirement 1: ショート動画セクションの検出

**User Story:** ユーザーとして、YouTube ShortsやInstagram Reelsなどのショート動画セクションにアクセスしようとしたときに、システムがそれを検出してブロックしてほしい。通常のコンテンツは使えるようにしてほしい。

#### Acceptance Criteria

1. WHEN ユーザーがYouTubeアプリでShortsタブをタップした THEN システムはShortsセクションへのアクセスを検出する
2. WHEN ユーザーがInstagramアプリでReelsタブをタップした THEN システムはReelsセクションへのアクセスを検出する
3. WHEN ユーザーがYouTubeのホームフィードでShortsコンテンツをスクロールしている THEN システムはShortsセクションを検出する
4. WHEN ユーザーがYouTubeで通常の動画を視聴している THEN システムは通常動画とショート動画を区別し、通常動画はブロックしない
5. WHEN ユーザーがInstagramで通常のフィードを閲覧している THEN システムはフィードとReelsを区別し、フィードはブロックしない

### Requirement 2: ショート動画のブロック機能

**User Story:** ユーザーとして、ショート動画セクションが検出されたときに、そのコンテンツへのアクセスがブロックされ、代わりに警告や代替画面が表示されてほしい。

#### Acceptance Criteria

1. WHEN システムがショート動画セクションを検出した THEN システムはそのコンテンツへのアクセスをブロックする
2. WHEN ショート動画がブロックされた THEN システムはユーザーに視覚的なフィードバック（オーバーレイまたは通知）を表示する
3. WHEN ブロック画面が表示されている THEN ユーザーは前の画面に戻るオプションを持つ
4. WHEN ユーザーがショート動画タブをタップした THEN システムはタップをインターセプトし、画面遷移を防ぐ
5. IF ユーザーがURL経由でショート動画に直接アクセスしようとした THEN システムはそのアクセスを検出してブロックする

### Requirement 3: 対応プラットフォーム

**User Story:** ユーザーとして、主要なショート動画プラットフォームすべてでブロック機能が動作してほしい。

#### Acceptance Criteria

1. WHEN システムが起動している THEN YouTube Shortsのブロックが機能する
2. WHEN システムが起動している THEN Instagram Reelsのブロックが機能する
3. WHEN システムが起動している THEN TikTokアプリ全体のブロックが機能する（TikTokは全体がショート動画のため）
4. WHEN 新しいプラットフォームが追加された THEN システムは拡張可能な設計により新しいプラットフォームのサポートを追加できる

### Requirement 4: アクセシビリティサービスの実装

**User Story:** 開発者として、AccessibilityServiceを使用して画面要素を監視し、ショート動画セクションを検出したい。

#### Acceptance Criteria

1. WHEN アプリがインストールされた THEN システムはユーザーにAccessibilityService権限を要求する
2. WHEN AccessibilityServiceが有効化された THEN システムはフォアグラウンドアプリの画面要素を監視できる
3. WHEN 画面要素が変更された THEN システムは現在の画面コンテキストを解析し、ショート動画セクションかどうかを判定する
4. WHEN システムがショート動画UI要素を検出した THEN システムは適切なブロックアクションをトリガーする
5. IF AccessibilityServiceが無効化された THEN システムはユーザーに通知し、再有効化を促す

### Requirement 5: ユーザー設定とカスタマイズ

**User Story:** ユーザーとして、どのプラットフォームをブロックするか、ブロック方法をカスタマイズしたい。

#### Acceptance Criteria

1. WHEN ユーザーが設定画面を開く THEN ブロック対象のプラットフォームリストが表示される
2. WHEN ユーザーが特定のプラットフォームを選択/解除する THEN そのプラットフォームのブロックが有効/無効になる
3. WHEN ユーザーがブロック方法を選択する THEN オーバーレイ表示、画面戻し、通知のいずれかを選択できる
4. WHEN ユーザーが一時的にブロックを無効化する THEN 指定した時間（例：30分）だけブロックが無効になる
5. WHEN 一時無効化の時間が経過した THEN システムは自動的にブロックを再有効化する

### Requirement 6: パフォーマンスとバッテリー効率

**User Story:** ユーザーとして、ブロッカーアプリがデバイスのパフォーマンスやバッテリーに大きな影響を与えないでほしい。

#### Acceptance Criteria

1. WHEN AccessibilityServiceが動作している THEN CPU使用率は平均5%以下に抑えられる
2. WHEN システムが24時間動作した THEN バッテリー消費は全体の5%以下である
3. WHEN 対象外のアプリが使用されている THEN システムは最小限の処理のみを行う
4. WHEN メモリ使用量が測定された THEN システムのメモリフットプリントは50MB以下である

### Requirement 7: エラーハンドリングと安定性

**User Story:** ユーザーとして、ブロッカーアプリが安定して動作し、他のアプリの動作を妨げないでほしい。

#### Acceptance Criteria

1. WHEN システムで予期しないエラーが発生した THEN システムはクラッシュせず、エラーをログに記録する
2. WHEN 対象アプリのUIが変更された（アップデート等） THEN システムは可能な限り動作を継続し、検出できない場合はユーザーに通知する
3. WHEN システムがAccessibilityイベントを処理できない THEN 他のアプリの動作には影響を与えない
4. IF システムが連続してエラーを検出した THEN 自動的に安全モードに切り替わり、ユーザーに通知する

### Requirement 8: プライバシーとセキュリティ

**User Story:** ユーザーとして、ブロッカーアプリが私の個人情報を収集したり、不適切にアクセスしたりしないことを保証してほしい。

#### Acceptance Criteria

1. WHEN システムが画面情報にアクセスする THEN ショート動画検出に必要な情報のみを処理する
2. WHEN システムがデータを保存する THEN すべてのデータはデバイスのローカルストレージに保存される
3. WHEN システムが動作している THEN ユーザーの個人情報（メッセージ、パスワード等）は収集されない
4. WHEN ユーザーがアプリをアンインストールする THEN すべてのデータが削除される
